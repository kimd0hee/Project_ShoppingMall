<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

   <mapper namespace="order">
	<insert id="insertOrder" parameterType="com.order.dto.OrderVO">
	 insert into orders 
	 (cart_id, product_id, user_id, receive_name,receive_phone, order_addr1, order_addr2,order_addr3,
	 order_quantity, order_price, order_memo, order_date)
	 select 
		cart_id, product_id, user_id, 
		#{receive_name}, #{receive_phone}, #{order_addr1}, #{order_addr2}, #{order_addr3}, 
		amount, amount * product_price, #{order_memo}, now() as order_date
	 from cart 
	 where user_id = #{user_id}
	</insert>
	
	<!-- 주문 상품 금액 -->
   <select id="sumMoneyOrder" resultType="int">
      SELECT NVL(SUM(product_price * order_quantity), 0) sumMoney
      FROM orders o LEFT JOIN product p ON o.product_id = p.product_id
      WHERE
      o.user_id =#{user_id}
   </select>
   
   

	<!-- 주문 상품 목록 -->
	<select id="orderList" parameterType="String" resultType="com.order.dto.OrderVO">
	  SELECT order_id, product_id, user_id, order_quantity, order_price, order_date FROM orders
	</select>
	
	<select id="orderDetail" resultType="com.order.dto.OrderVO">
	  select order_id, cart_id, product_id, user_id, receive_name, receive_phone, order_date,
  		order_addr1,order_addr2,order_addr3, order_quantity,order_price, order_memo
  		from orders where order_id = #{order_id}
	</select>
	
	<!-- 주문 수정
	<update id="updateOrder" parameterType="com.order.dto.OrderVO">
	  UPDATE orders
	  SET receive_name = #{receive_name},
	      receive_phone = #{receive_phone},
	      order_addr1 = #{order_addr1},
	      order_addr2 = #{order_addr2},
	      order_addr3 = #{order_addr3},
	      order_memo = #{order_memo}
	  WHERE order_id = #{order_id}
	</update> -->
	
	<!-- 주문 삭제 -->
	<delete id="deleteOrder">
	  DELETE FROM orders
	  WHERE order_id = #{order_id}
	</delete>
	
  </mapper>